name: Rust

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

env:
  CARGO_TERM_COLOR: always

jobs:
  test:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: Cache Cargo registry
      uses: actions/cache@v1
      with:
        path: ~/.cargo/registry
        key: ${{ runner.os }}-stable-cargo-registry-${{ hashFiles('**/Cargo.lock') }}
        restore-keys: |
          ${{ runner.os }}-stable-cargo-registry-
    - name: Cache Cargo index
      uses: actions/cache@v1
      with:
        path: ~/.cargo/git
        key: ${{ runner.os }}-stable-cargo-index-${{ hashFiles('**/Cargo.lock') }}
        restore-keys: |
          ${{ runner.os }}-stable-cargo-index-
    - name: Cache Cargo build
      uses: actions/cache@v1
      with:
        path: target/debug
        key: ${{ runner.os }}-stable-build-target-${{ hashFiles('**/Cargo.lock') }}
        restore-keys: |
          ${{ runner.os }}-stable-build-target-
    - name: Build
      run: cargo build --verbose
    - name: Run tests
      env:
        BINANCE_API_KEY: 0jfxupurrR9GS4las3IPSCceuRXLNVIfR00LkmX40s5VIapxo67bIds0os9W0Kc0
        BINANCE_API_SECRET: 7CknasnJSGggzqfOeqHN8Qy9afwiBYnh96Q8cW9SSAcyCd5JZyMouoBvKUdZpDE8
        COINBASE_API_KEY: 71178a875b2e58cf722768c97cc6cbd9
        COINBASE_API_SECRET: qWEkW67MjhHTmP0V5qOiycl8B1IWil3jumFmteYnkGH6Fycn1W5/iF9OwluACnIhby0fatCr++L+X9PJB8/jLw==
        COINBASE_PASSPHRASE: hzy38ul8f3j
        NASH_API_SECRET: eyJjaGlsZF9rZXlzIjp7Im0vNDQnLzAnLzAnLzAvMCI6eyJhZGRyZXNzIjoiMk10VTc4dkYyOHFSUXNtRXk4bUFlWDhrSm55NHd5U1VURFUiLCJjbGllbnRfc2VjcmV0X3NoYXJlIjoiNDQyYjE5N2MzODBhOGYxZGEzNzQ3M2VlNjZhZDA2ZGE1OGEwZDA0NGQzOGY1ODdkNDg5MzMxYTY4ZTkwZjhhYSIsInB1YmxpY19rZXkiOiIwMmI0NTAxNTVkOTI2NTU4M2ExZmJlYzNjYTU3MDE4NDcwNDI0MDc3MGZiNmNjMTI0M2MzOTA0ZTEzOGQ2NTRhM2MiLCJzZXJ2ZXJfc2VjcmV0X3NoYXJlX2VuY3J5cHRlZCI6ImQzNTAwZDY5Y2Q2OWUzY2NkNTAxMjBlNDY5OTg0OTJiODljOGVmZTNhZjUxNTJiMjgyMjVmOWYzOWQ1ZDY0MWY2OWZmNzljNGE5ZjgzZTcwZmJlNmMxMTEwZjllOGMyMTMyYWUzZDQ4NTk4NTM5ZjkzNDIyNmVlYmQ2ODRiM2ZmOGVkOTYwMzVjMGRlMWZiMGJkNDI5NzM1NGM2ZTVhNzA3NTc2NzJjZGYyM2FiZDRmYzQyODNkMmE2YThhMDQwNThkNDM5NWRlYTE3ZjJmNDg1MmYyYTA2NTRiODc0N2QwZjA2NDYwNzRkYWVkMzQxOGYzMWM2MDVkZWVhNWJiMzBlMTg3ZGNiYjQzYzUxZmVkMmM0YjRiYWQ1NmYwZmU5MTg2YmNmNTdlNmI0NzYxNjFhNTcyY2FjY2JjMWM0ZWRkYjJiM2VkNjE1NzJjZTAyODk3MjIxZWU0YTM5MDJjODQwMzBiOTg5NTY0OWMzMWMxZmMzZTZmZWRhZTU2ZDZmYzllYTgzZTRlYmJiNDgyZWExYTExZDA5MWQ4MmViZTRiMWZhN2Q4MGM0MzZkNTc0MjQ3MTU5MTMyZGJkZjRkOGEzNDU0YjFkNWU2ZGY4MGVjODAwMDJmMjJkMjBjNWRkZGNiZmE1ZTkyMzJmNmYwNTNhZGI1YWU4Yzg3N2RmMTZjOTJmMDNiNjkxNWE5ZTI1ZTNjODM0OTY1ZDBmNDJiY2ExNDRkMzM0YmMxY2M1NjZjNjYzOThiOWI4OGZlYTdkM2ExZTRjM2NjYTZlYjI3NWRiY2RhOTViMzVmZDYyMjdkMTgzZDgyNGFiYzJmODdhNjQwNjMzNDQ0MTlhYTFlMzU3NThjNmU1OTg5OTYxNjQwMGZhOGNiZTQ1MDc1YjI2MTU1MGEyMGY3OGM1NGVjNWEwNTIyZTkxN2I5MTExMGY1NjAwYzk3YjA1Zjg0ZDY3ZGUwNjQyMjM4ZjlmYTAyM2UyMTlmZjliOGYyYzkxZDk0YjE3YzkyNDQ1MWFiNzA3MTFkM2I3NGM1MDc5ZTYxOWU4MWYzOGNmYjIxZGQ0NzY5ZDhkODMwYmU3NGQyMTExZGRlZGNlOGI5MDBkMWEyNTljODBiYmUzMWIwODg0ZjFjZTAxYzhhMjkyN2NkNTdhNmM2MWUyNjI5NGRhOTYwZTNlOTgzYzBlMzI1NWFhZWZhYTUwMGU2MDE0YWEyNjM1ZTk2MGFlZWU4OTY0YTlkMmE5YmFiY2NmOTMzY2MyZDM0NWQyZjUwMDRmY2FkZWE2ZGE1YTRhMjdkZDZiZTk2YzdlYTE5MWM1MGM0NGE3ZGU2NmNjNmRkMTQxZGYxNzhmNDAwNzkxNjg1NWJlMjYzNyJ9LCJtLzQ0Jy82MCcvMCcvMC8wIjp7ImFkZHJlc3MiOiIyYTBhODVlMDBiZWJiNTc2MjI0YmI0YTkwMDBmMDE5NjE3MDA1NDg2IiwiY2xpZW50X3NlY3JldF9zaGFyZSI6ImNkMDNjNGY5OWRhZjNmOGYzNGJjODNjZTA0NmJiYjk2ZjU4MmY2YTg5ZGRjYWI3NjQ4MTU1NjFiODNhOGQ5NTIiLCJwdWJsaWNfa2V5IjoiMDQ4NjQ2ODU1ZTgzZTM0NjNhYzQ3MGQ4NGIyZDM5ZjdjNzQxMzk3YTM0ZTllYTM0NDBlMzQ3ODlkNThjNTljYzgzNTRlMTlhYTFiZmMzMTljYjcxZGE0YmY5ZTZlZTZhMzc0MTk1NTEwNzU3YThmNTU2MmU1NmFkMjBhYjdiYjYzNiIsInNlcnZlcl9zZWNyZXRfc2hhcmVfZW5jcnlwdGVkIjoiMTIzY2EwYzcxYzhiMjU5N2MyOTc5YWI1ZjQ1NWFhYWFkMmYxYjY3Y2Y1NDFhNDQ1M2ExMWJmOTliNmRmN2QxZDJjN2JmNDVlMzgwZTBmZWZhNjljZTMwMDEwNmVkZTI4MDZlYTI2MTllMGI1Nzk0ZTUyOTIyMDhjY2ZhNmI1MWVlZDU3ZjBiYzZjZjE5Njk2Yjk0OWMzOGMxOTFiYmU0NDk0MTk2NmMwZjM5OTJjY2MzZjUwYjM5OTc2ZWI1YWQwZGRiOWE0MTgzYWEwMTc0OTdjZDhiY2U3OTZjYzIzMzAyZjk0YmNmY2Y0ZjhjNjA3ZWM5ODdkZmFkMzU3MjhhMGRhNTllMDU0N2I0YmM5MWVjZmU2ZWRhMTVmZjE2MDM5NWNhM2QwYzhiZGYyYjg2ZTllMjQxZTg5Y2M0MzFjMWYwODMzZjRlMzQzYTcxYzljZjkxYTBiOWQwM2E0Nzg4NmM1NDQ5ZTY4YjE2ZjYxNmVjNzk5MTVkMjNhZjdjOGI2NDI1YzE3NDdhYmYyYmE1NzBiYjNmMDc1ZGJhNGE1YTYwNzQxYTQwZTJmMzc0ZjQ0ZmNhM2QwZWY2NTU1OGM2OTliNmZiNDY2MWNiZDU4ZjYxZmEzNGE5MTY5Y2ZiMDFhNWM5MGFlZWFhNTIwMmQwOTk1MmIxZWE3NDEyYWE5ZmQ1ZmRiMWU4MWFlMTY2MjY2ZmU0YTIyYTFlZmQwN2RhMzYyMzk3ZDg1NmJiNjgxNTVhYjkwMTU5YjZmMWFmOGIwNzgzNjk0YmIzODIzYWM5ZWVhMmE2MzI4NDZmZWNiMDRmNTU4MDNlYWNmNGU0NjU2NjY0NjM4YWI1YjAxMDJlNDIxMzljNmRhOTFjMGIyMzhmY2FkY2ZjYjhkYjUyNTQ2MTU0OTNkM2U4NGI2YWIwNmMxZTQ3NzU2NzY1MWFiZWQ0YjBiNmFiMTQ1ZDU4NGM0YzM2YjE0NjJiMzAyYmExZDY4ODdkNzk1N2VlYmI2YzI3MjRhMDZmNTAyMDZkOGNjODJmNWZjNGYxM2FhYWIwYTYyYjM4YzkxM2Y1Mjk0YjViYTkyNGMyNTM2MGZmOGUyMWY1YTA1NDgwZmVlYWZlMjEzYjdjZDU4YjFjZDgxMDc4MTZmY2UzZDY5YTQwNmRmNzRiNDMwOTBmYjgwNjFiNTNmNmYzNTk0YmZjNWQzMTBjYzIzNTFlNDEzNWJhNWZiYTE4NTk0YzgyOGRlNjgyZmJjOGU2OTdjMGMwNGFiZThhMTczNWFlMzE1NjYxNGJiNzIxM2UwM2Y4N2UyYmMxYTkwYzA4ZDI0NWM5MDU1NmVjZTQwMzIzMDNmMjMyOTg3OWNhNjU1MTc0NDkzZjhjMiJ9LCJtLzQ0Jy84ODgnLzAnLzAvMCI6eyJhZGRyZXNzIjoiQVR5SE1CTkdZRnl1VzNiY0tuS0JIRjZ3TjlBWFRzSjhCaSIsImNsaWVudF9zZWNyZXRfc2hhcmUiOiIzNDU2NjI2ZDlkYjg5YzYxNDUyOGViYjQ1ZTc1ZDZlOGVmZDQyZGRjOWQwOGRmNTM3ZmIwNWJmYTgxYjM2ZmJlIiwicHVibGljX2tleSI6IjAzNWM3ZGE2NTExOTdkMTNkMmNmMjNjMzcxN2U2ZWRhMjE5YTZjOTkyZTM5MjhmY2IyZWYyMmI1ZWI5NGQ2ZDc5ZSIsInNlcnZlcl9zZWNyZXRfc2hhcmVfZW5jcnlwdGVkIjoiMTlkOThmOGNmM2Y2ZDYyZDliMTg1ZjhiOGE1ZGJhZmYxODMxMTJlOGIwOWQ2ODM1YTEwOGVkYTI0OThlNzQxOTM3MDRiMzc1M2EzZjIxMWViOTBiZmNmNmM0ODU5ZmM3NWVmM2RmMDdkMGNjYTQ0OTkyMzU0OGJlMTZhOGMwZWE0NTU1OGY4NTFkMTdmMzM2MWE3YjNlNTE2ZjZkY2Q0Y2I3MWFmNjFhYTFhNzdlYjBkYzNkYTlkNzYyZDE4ODc3YmQwNjgzOTg3ZTI4NzY0YWM2MDA3NGZjNjFhMTUwYzdiZDVkZTg5MzBiNDg0ZTdmMDdhN2E4ZjliMzg0ZjkwOGU3ZDJhYjFjOTNiZmVjZWQwMTA5MGYzODI2NGVmODhmOTA2NGVhNGFkMjU1MWMxYTFjNTMyYTUyMWMzNTYxYmQ4OTdjNzAyMDNjYmVjMmZkNzRlM2U5NDA0ZTRkOTA5NGZjMjk3MTYyNzgwNTkwZjU5YjJkZTk5NmI0MWY3NGE2YzAyMjRkNTZjNjU0NDlkOTE4NDgyMzA1ZjQxMTI5ZmU2NWE3NWY5ZTkyZjlmMzk0MjVmYjdiMjYzYTgxMzcwZWZiZmU5MzE2NzZhNjI5NWNhY2NlYjQ2YWJiNTRmOTYwOGJlMjVhMTAxOWRhMDQ2OWVlMjZkMDdjMGIyZTQzMzhkNGNiZmNiNzhhYjFhODY5MmY3MzI5NTA4NjA0ZjZkOTM0Zjc1ZDNkMDIyNzZmMmRmMDg0NzRkZjUwNzgzYmIxNjk1MTllZDZjMTVjYzk2MzNmYWZmNDk4NzVjYWU5ZjQ2ZWY3YTM4Y2ZkNjY2NTJhMDM2NDlkZTcxZDliODAxNWEwYjUwNjkxOWMwNzNmZjQwZWE0MTU3ZWFkYTU0Y2IyZWJkZjZhMGZiZWI3YjA0N2I0MTQ4NjAyN2M0NzViMmFlMjU3MTRhY2ZhNjY5ZjJjODUxMzkxNTY1YmQwNjg3ZWE1N2NkYmU0ZmQ0MzA5YThkMWNlMjYyMTM5MTYwZTcwMWZjYzgyOGI4ZDE0ODg4OTA0Y2Q2ZDU2NjUxMzc0NDQ0MDI0Mzc0YzdjMGYxOGViOGMzNjBmYzQ0ZWVhNjdlOTMzZTMwNzRiMzllZmNhNzJkNDAwMjYzMGNjODU0YzQ5MDkxNGY2NzA1MDI3YTNlY2ViZDBjN2IwYTU4MzRlNjk0ZDgwNjNkNmQ0OGFiZjgzOWY4YTBkNmY0ZTZjYjhiZWU2MDIyNGNiMTQyY2Q0OGY0ODYzNTAyY2Y0NmZkZTJmMDZhNDBkNDg2MjZjNjFhNzMzZGUzYjNhOWNiMmYxOWJhYjVkY2VkNjU2OTI2YzMxYmU3NDdlZmJlZGY1ZWNlZSJ9fSwicGFpbGxpZXJfcGsiOnsibiI6IjU5ODdlNjIyMjYxY2FmOTZlMjU4MjZjNzBjZjMyM2IyNjE5NGZmOWNmZTY5ZTNmNDBmMzBkMzA2NTcxNjQyY2FlYThhMzE0M2QxMWZmOTRjMTM4ODM2MDQ4NjczNTdhZThjMGU2NjNiZjAzZDAwOTMwMTZkN2Y0ZDc5MGFlMjRlMjkxNzgwM2Q4MTJiNjQxYWYyZDZjMDk1NzNkMTEyZWI3Njg2NDY1MjkxY2QxNDZmZDY2MmY3N2Y1OTVlZjgzMjc3YmUxNjgwZDA0MGIxZjNjNDk5YzgxOTE3NTcyMDZlNTEwYWU1NDcyNGQ2NjdmYzA0MWEyYzdjMmZmM2QzYjY2YzM3MjlkYzI1ZTAyYzQwMTllZDNhMDEyZmQ3NWVjMGUwMzk0OGNmNzgzYWQzOTAyY2U1ZTVlNzIyMjljM2RkM2ExNGI5MzRkNjAyNjlhY2I3YmEwYmQ0MTVkMmRlMTI4ZWYxODcyMjQwMGJhZWEyZTg1MGU2ZDFmZDg3ODdhMDEzMGQ1MTYyMDZkNzE4YTQ5ZDdhMjFkNDI4YjBmYTM3NzMwNzliNjQ4NjE4MTExOTFiNTUwMDFkNGMyYzI5ZjYzMDMxNGJlMTkxY2YzY2EzZjBmOGUwOWVlMDk1NDNmZmRkYTNmOTdjZjE2OWQ1MmUwNjdjZmQ0MGNiMzAzOTQxIn0sInBheWxvYWRfcHVibGljX2tleSI6IjAzZjEwYWNkMTlmZTlhOTBlZmY4MDQzNjVjOGE3NjExMTk4ODdiMmQ2ODdmNDYwZDNlY2E3NDJlNGU0Y2ExYmU4MSIsInBheWxvYWRfc2lnbmluZ19rZXkiOiJiYmQzZjM0MjUyNTE0ZmVhMmFjODU5ZjI2OTNiMWM5M2M3OTZkMDI0NTNhMDU0ZmY2YzkzNTkwMzllMGM2MGEzIiwidmVyc2lvbiI6MH0=
        NASH_API_KEY: 6af7eef9-8812-4a9f-9385-09a4b9924921
      run:  cargo test --release -- --test-threads=1

  clippy_check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - uses: actions-rs/toolchain@v1
        with:
            toolchain: nightly
            components: clippy
            override: true
      - uses: actions-rs/clippy-check@v1
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

  rustfmt_check:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2
      - uses: actions-rs/toolchain@v1
        with:
            toolchain: stable
            components: rustfmt
            override: true
      - uses: mbrobbel/rustfmt-check@master
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
