name: Rust

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

env:
  CARGO_TERM_COLOR: always

jobs:
  test:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: Cache Cargo registry
      uses: actions/cache@v1
      with:
        path: ~/.cargo/registry
        key: ${{ runner.os }}-stable-cargo-registry-${{ hashFiles('**/Cargo.lock') }}
        restore-keys: |
          ${{ runner.os }}-stable-cargo-registry-
    - name: Cache Cargo index
      uses: actions/cache@v1
      with:
        path: ~/.cargo/git
        key: ${{ runner.os }}-stable-cargo-index-${{ hashFiles('**/Cargo.lock') }}
        restore-keys: |
          ${{ runner.os }}-stable-cargo-index-
    - name: Cache Cargo build
      uses: actions/cache@v1
      with:
        path: target/debug
        key: ${{ runner.os }}-stable-build-target-${{ hashFiles('**/Cargo.lock') }}
        restore-keys: |
          ${{ runner.os }}-stable-build-target-
    - name: Build
      run: cargo build --verbose
    - name: Run tests
      env:
        BINANCE_API_KEY: 0jfxupurrR9GS4las3IPSCceuRXLNVIfR00LkmX40s5VIapxo67bIds0os9W0Kc0
        BINANCE_API_SECRET: 7CknasnJSGggzqfOeqHN8Qy9afwiBYnh96Q8cW9SSAcyCd5JZyMouoBvKUdZpDE8
        COINBASE_API_KEY: 71178a875b2e58cf722768c97cc6cbd9
        COINBASE_API_SECRET: qWEkW67MjhHTmP0V5qOiycl8B1IWil3jumFmteYnkGH6Fycn1W5/iF9OwluACnIhby0fatCr++L+X9PJB8/jLw==
        COINBASE_PASSPHRASE: hzy38ul8f3j
        NASH_API_SECRET: eyJjaGlsZF9rZXlzIjp7Im0vNDQnLzAnLzAnLzAvMCI6eyJhZGRyZXNzIjoiMk10ZUNidXZ3em9rQUh3N0VGZXlUQ2REekNQb1ZmQVJVOHoiLCJjbGllbnRfc2VjcmV0X3NoYXJlIjoiNWJlMjg0MTkzMTBjZGZmNDU3NDY3ODBkZGQwOTM2YjE4MjUxNDhjZWJkZDM3NmM2MTcyMzM1ZjQwZDZkMjAxMCIsInB1YmxpY19rZXkiOiIwMjFmODkxNWFiOTVkZDFiNDBkMzU4ODgyZTE2ZDFlYmEwMDExOTI4YmY0ZWE2MWE4NTRhMTA2MzVhODQ4OWRhOWUiLCJzZXJ2ZXJfc2VjcmV0X3NoYXJlX2VuY3J5cHRlZCI6IjFjZTE0YTM4OWJkYzRiZjU2M2Q1YTM5NjQyMzI2YmU1ZmI1NzQyZDVmMTZmODc4MjI1ZjJhOTYxZWM3MTU3MGIyOWQwZGYxNjE5YmNlOTM0YmEwNDk5OTY3MWM2NTA4ODQ4ZDMwNDBiOGI1MTI3OTE2OTU1ZjQ4MDAwZjUzMGNkNjg3ZDZjMTgyMzVkYzVjNDk3YWNmZjJlNjE5NjJhNDhlZDYzZTQ1NGNhMzBmYjc0ZWIxNWQzYzRjNTk1OTYxMmJmYjQxYTA1ZWMxNjA4MjBhOWZmMzhkNDU2OWM5MTZmYzA3YzkwNjAxNTdkZTdlNjgxZGYyMTQwOTUzMjQ2MjcxZDVkMGNiNjYyZjExMTNiOTE2ODFlN2IzMmJhNDk1Mzc4NGY0ZDE0ZjAwZmZjMDZjMmQ0ZDA2ZjliM2NmZmUzZDQ4OTY0YTVjOGMxMDJmNDNjOTc0NDZjNWUzYTU5NGExOGJiOWEwYTY0MTYxZjI2YWM2YmU0MDM1NDdiYzc5MTM0Y2JiOTcyN2Q5ZWFhYzY0OTFhMTAwNGFlMTU2MjBkNmVhMTcyMGRmZTkyMTI4ZjUzODlhNDg3ZWRmYmI2ZmEyNGMzNTFlMDcyYWVlOWYyNTg0NWFkNjY3MTEyZDllNWM1MTE5ODcwMGY2NjQ0MzU4Y2FkNWZhYjRhN2I3YmMyMzU1MjAzNDdlYjBjM2Q4YmI3OGQ4YTI1YzM3MjAxMjhkOGNhZGI5MjgzM2NmNDEyMWIzZWJhMWE4YzAzYmQxMTYxYjllOWZmNGJhN2JmNzRiMmFkZjk0Mjk1MWQ5OWYyZWMyMjc0NTcyOWRjZjI3NTRhZWIxMjBmZGMyZTFmZjliZWU3ZDFlZDk0NjNkNDRiMDE3MTU0Mzg1YjgyYzg2MDcyYjk0OTVhNmFiY2IxNzQ0OGNlZGYxZWIxNzgyOGJhYzBlODk5NWE5YmVhMTJmMzJlZjQyOWQ1NDYzOWY0ZDI5Nzk4YzgxZjIxM2JlOTFjNjVhNGM4MDQ0M2M3YmZlZTZlODJiODNkNTIzZTQ5ODE2ZGZlMmM5YzgxYzg5ZDk3MWFkYTc2MTYwZjBmMmNkZWUyZDIxYWI1Y2UzYTYwZDE4YjUzYzYzNWFiMDQwOWNiOWJiYjQxZjg0MGIwZTRlZjg1YjI3ZGRhYmFiZGVhYTYxOGU1ZWM4ZWU5ODcxYWMwYjA0OWRiOTU0OTZiZjFkYzUwMTgzMzg1NTY0NzY0NWIzM2UwMDQ2ZmYxYTJlMTdmMDg1ZDdhNzRmMmY3OTBmNmU1ZjBhY2Q1YmI5YTlhMDgyMWEzNTAxMzM3MjMzZjU3YmNlZTY0ZTAyYzA1ODRmNWU1OWNmMTZjYzFlNjhlYzYifSwibS80NCcvNjAnLzAnLzAvMCI6eyJhZGRyZXNzIjoiNzIwMjY0MjlmODU3MGZhNjYwNzY2ZmRiODJiMDY3MWE2NzE3ZmU2YyIsImNsaWVudF9zZWNyZXRfc2hhcmUiOiJhNjMzMjdjYmQ3YmE0Y2Y5M2YzMDkyOGRkNTA0Zjg0MWU5NDRhNWFjMDVkZTRiNTM4ZjVhZjZhNjc3Y2Y3YWYyIiwicHVibGljX2tleSI6IjA0Y2IzMDM4ZDYxYmRmZWEwOWFmNmYyYmU3NTcxZjY2NTE1ZmM1ZDczMzFkYmRmODk0NmUyM2M3ZDkyNzhhMTE5ZDg0MTlhYWY0NTZjMzhhMTQxYmM1NTU0NTA0YWNlODI2N2UxNzYyZWE0NzY3ZTExNGU0NTVkOGI5N2NlYzYwOGMiLCJzZXJ2ZXJfc2VjcmV0X3NoYXJlX2VuY3J5cHRlZCI6IjE2ODdjZDI0M2UwNzM2NDRmMjQ4ODdkYTZlNzc1OTY1ZDk4MjlkZTBmMzM2NmMyNGQ4MDY4Y2M2NWZkOGVmYWEyMTQ1NTU3MjFkOTIyNjdkODI4NDMyNzMwZGVlNDNjZjIyMjI5NGUyYWE1YWNjY2JjZmIxZWNlOTMxM2I0NTkwMmMyZTMxMDQ4M2VjZDVmNzUwNGViZGZhYTQwNThiYmQyMGJlNTFiYTgxZjQ5ZGFjNGYxNmE0NGE2NzQ1YzU2OTBhNDdjMWYwYWM2NWNlY2I1MzMyZDZlYjg0ZmUyNWM5ZWVlMmY5NjE3OTEzNWIwZGMwMGRkNmFlNDE5ZmRlMTAyNjExODQwNjA1MDk1ZjVjYzE5NjVmYjMwNTU1ZjU4M2I0YWUzZTc0MDAwNGJmNDllMDIyNGVlYmI5YjliMmNlZjQ3OWRjMzliNGRhZWI2YTRjM2VkZWRiYjdmNmZmODliOTVkMjY1ODU3NjQwZWJiYTdkM2IxYWExYjIzMDU4ZmY5YWU3YmU0YzBkOTQ4NGZhY2FhZmQwNTlkYjgwMmVkMWIzZDg5MGYyNTQ5MWJhZDY0NjRmNzYxYjEyZTE3NDc5MzJiMGUwOTI2MThiYjVkZWJkNWQyOGJhMTFlMjMzMjk0M2Y0Mjg1OWZmMDZhYjg0YTA1YjEyZDE0ZmVkMDdhOGFhMTg5ZDBmYWZlOGZmNWEwZjI3ZGFlZDRiNDEwZmYyOTNhNTU4ZTY2ZTlkMzg0OTE2MGRkMWE2ZDA2OWM3NzE3NTcxY2E1M2RiNDBiYmQ0NTYyYTEzZTcxZmYwOWI0OWJmYTI2OTJjYTk2N2U0MGY5YjZkYzY5NzExMjBiYmIwMWJlNjViNmJhZTAwYjJkMzNjODNlZjRhMWFkYjNmOTk4NjllM2Q5YjIxNDE5MDhlN2ExOGQ5ZGI5MGJiZTI2NDU0NTk3MzA0NmU1Y2JiZjVlYjc0ZGU5YTY5OTJiMzE2YzJkNzJlOTA3YTczZmU4NTJjYjIzYzNkYThlYzk3NWQyNGI3NGJlYjVhZGQ1NTllYzg4ZjA3MjY3YWVkNjI5YTUxZjQ1NzQ0YWNlMjhmOTgxNTU5ZGU4Y2RlMDc4MmNhZWNkZjg0NTA1Y2MxYWE3MzBlYjlkYWIyOTllODhiNWJhNTQ2Yzg3ZjFiN2ZjMTk4OTMxY2NiOWFmMWQ5ODg1Zjg3ZGEzY2VjMTUyZDU1ZDJiNzQ2YzQ2NDliZGI4NDBhNDNlZWI2N2FlNzBlY2I4ODU1MDAzZTNmNDRjMjUzZGI1OTg0YzJmNmFhYjlkZDNjMmM3OWQzZDhiMzBiZjcxYzI4NTAxZTFmNDYzZTI0YmRhYmRhN2I4ODQ5NDk2ZDQifSwibS80NCcvODg4Jy8wJy8wLzAiOnsiYWRkcmVzcyI6IkFKbW1jOHZpcFBCcmpSWm5RRGNuUnVNeFF3ZWJ5UGtwaFYiLCJjbGllbnRfc2VjcmV0X3NoYXJlIjoiYTI1NjlhN2QwMWNiN2NmYzYzOWNmMTcxNmRiYWZhZTYyMTQ3NGVlZmZlNzQwNjBhZTdmNmRmMGViMjU5NTZkYSIsInB1YmxpY19rZXkiOiIwMjg5MGNjODE5NjAzYmY3M2ZjMGM4NTAxODNiMTQ0ZmM2YzQxNWQzZjY4ZWRlNWIzOTE1MTJkNGY3MjdlZTM1MDEiLCJzZXJ2ZXJfc2VjcmV0X3NoYXJlX2VuY3J5cHRlZCI6IjkyZWRhOWI3MmU0YmIxZGI1YmEzOGE0MjU2MDYyOGU4ODFhZWViMjhjZjM4ZjYwNGM0MjdlMjZkMjI1ZWFhMTZiODE4OTQ3YWExYTU5Y2VmMmRlNWJhZTBjYjI4YTViNjdhMzBiMTE1NzI2ZDkxODkzYjkzM2JkMmZlN2JhOGVjMjk3ZTFiMDkxMDhiY2QyNzRhNTUxZjdmZDYyNmRlNzZhMjQyNzQ4OGRhY2I4MWM3ZGRmYTg4ODQ3NzI0NGZmMTAyYjBmYWEzZWU2MDJiZGI4Y2NhYjQ0MWM5MjU0Njg4ZjFhYWVhYmE0NjlkNmYyOTlhZDE3NWE5YThkMjBlZjk2NmY1YzhiN2ZiMjRlNThkYWU3YTA2MjE4MThiMzQ4OWI2OTczNDJlZjE4N2IwMjI2NzFlYTU1NzRmOTE4NjIxNjc4NTZiMmQzMDJiOGFlZjA2NjViMDg4ZjYzOWU1MzU1YmNlYjU0NDNiYWJjYjAxZWU3ODQyZGQ5NTA3ZWZjYzE2ZDdhOWE0OTNmYTE1OGViZjMxYmIyZDRjOWI4YjNhNWFjMTA2ODU2NTI1MGFkOTRlNzk3OThjMzlmYjRkY2JiMzAwYmIzYmFiMjI0NGYzYzI1ZGM2ZDQ4ZTg5YzQwYmFjNzliYzhjYTcwMGE1M2M5OGI3MjVmZGMwNmJhYTJjYWM0ZWE5YmQ3NTEzMTcyOTA4YWJkMDEyOThlYzE3YmJiM2QxMTFkOTU3YmI2OTY3NWVlNWRhYmI0Nzg5MjI4N2U1ZDIxMzliNDM1ZDM1OTM3NWMxMWUzZmRjOGU0YzBhOTNkYWE1ZDYzMTI3NjgzMDMwYzFhYzUzZjM0ZDY5NTRmYjkxODBlYzkzNGRhZDE1YmNiMDFlMTYxN2FhYjM3NTM2OThkOWMxZDFiODcxNjkzZDc3M2Y2OWRkNDczYjhhOWMxYmE1NDE4MmRlMGRmNDJiZjM0MWFiOGM2Mzk2NGU5NDAxZDQ0ZmZiZGE2NTU4ZTc1ODA2MWZiZWJhM2I2NDAwMzM2MjNjYTY4MmJlYTI3YzAwMWQxNjk2ZWZkMDVlYTU3ZTUyNDM4ODE4Zjg0MGUzNDM1ODg4OTNkNGY2ZGE4YmY1ZjhlODU1OWU1NWU1YmJmY2U0MTBkZjY2YWIwOTYxMDVhMmIzMmU5YmVkNGNkZjdhNDBiNDQ2YzZkMTQ4YjVkMmNlYzQ0YzNmMmI2ZTY2ZDRlZGVkOTBmMjY2YzMyMTYxNWUyMGFmMmQyZjBhNDA5MzQ2YWUyZmU3ZTQ0OGEyZWYxMmQ4NjQyOGZlYTNmYjJiMTk4MWUxYWMxMmUzZGI0ODgzODJlYjgzZTUzNWQ4ZDJiOTlkYjdmMzM3ZCJ9fSwicGFpbGxpZXJfcGsiOnsibiI6IjU5ODdlNjIyMjYxY2FmOTZlMjU4MjZjNzBjZjMyM2IyNjE5NGZmOWNmZTY5ZTNmNDBmMzBkMzA2NTcxNjQyY2FlYThhMzE0M2QxMWZmOTRjMTM4ODM2MDQ4NjczNTdhZThjMGU2NjNiZjAzZDAwOTMwMTZkN2Y0ZDc5MGFlMjRlMjkxNzgwM2Q4MTJiNjQxYWYyZDZjMDk1NzNkMTEyZWI3Njg2NDY1MjkxY2QxNDZmZDY2MmY3N2Y1OTVlZjgzMjc3YmUxNjgwZDA0MGIxZjNjNDk5YzgxOTE3NTcyMDZlNTEwYWU1NDcyNGQ2NjdmYzA0MWEyYzdjMmZmM2QzYjY2YzM3MjlkYzI1ZTAyYzQwMTllZDNhMDEyZmQ3NWVjMGUwMzk0OGNmNzgzYWQzOTAyY2U1ZTVlNzIyMjljM2RkM2ExNGI5MzRkNjAyNjlhY2I3YmEwYmQ0MTVkMmRlMTI4ZWYxODcyMjQwMGJhZWEyZTg1MGU2ZDFmZDg3ODdhMDEzMGQ1MTYyMDZkNzE4YTQ5ZDdhMjFkNDI4YjBmYTM3NzMwNzliNjQ4NjE4MTExOTFiNTUwMDFkNGMyYzI5ZjYzMDMxNGJlMTkxY2YzY2EzZjBmOGUwOWVlMDk1NDNmZmRkYTNmOTdjZjE2OWQ1MmUwNjdjZmQ0MGNiMzAzOTQxIn0sInBheWxvYWRfcHVibGljX2tleSI6IjAyNDQ3YTkxNWI0ZTQwYjY0YTIwZDg2ZjdlMzBiZWE5NzNhM2NkZDAyMTVhMWMyZjhiOTNkMGQ1NjFmZDE1YTQ2YSIsInBheWxvYWRfc2lnbmluZ19rZXkiOiJkNzlhOWUwY2M4YTM4MTBkM2QwMjkxYjEzZDVjYjI1OWZmZjk4ODY1MDIzY2EyMDk0M2JiNDM2MzVmYmRiNGUxIiwidmVyc2lvbiI6MH0
        NASH_API_KEY: 3be349f6-133a-4b61-bb20-eae83ae1973a

      run:  cargo test --release -- --test-threads=1

  clippy_check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - uses: actions-rs/toolchain@v1
        with:
            toolchain: nightly
            components: clippy
            override: true
      - uses: actions-rs/clippy-check@v1
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

  rustfmt_check:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2
      - uses: actions-rs/toolchain@v1
        with:
            toolchain: stable
            components: rustfmt
            override: true
      - uses: mbrobbel/rustfmt-check@master
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
